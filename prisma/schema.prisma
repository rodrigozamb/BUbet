generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                     String             @id @default(uuid())
  name                   String
  email                  String             @unique
  password_hash          String
  created_at             DateTime           @default(now())
  username               String
  role                   Role               @default(USER)
  is_confirmed           DateTime?
  profile_url            String?
  position               Int                @default(0)
  last_activity          DateTime?
  points                 Int                @default(0)
  favorite_competitor_id String?
  bets                   Bets[]
  Feedback               Feedback[]
  GoldenBanner           GoldenBanner[]
  notifications          UserNotification[]
  favorite_competitor    Competitor?        @relation(fields: [favorite_competitor_id], references: [id])
  badges                 Badge[]            @relation("BadgeToUser")
  userSeasons            UserSeason[]

  @@map("users")
}

model Event {
  id                 String         @id @default(uuid())
  name               String
  description        String
  date               DateTime
  starts_at          DateTime
  ends_at            DateTime
  created_at         DateTime       @default(now())
  banner             String
  local              String         @default("NÃ£o Definido")
  bets               Bets[]
  eventResults       EventResults[]
  estandartes        GoldenBanner[]
  event_banner_types BannerType[]   @relation("BannerTypeToEvent")
  competitors        Competitor[]   @relation("CompetitorToEvent")
  judges             Judge[]        @relation("EventToJudge")

  @@map("events")
}

model Competitor {
  id           String         @id @default(uuid())
  name         String
  profile_url  String
  created_at   DateTime       @default(now())
  description  String
  eventResults EventResults[]
  estandartes  GoldenBanner[]
  users        User[]
  badges       Badge[]        @relation("BadgeToCompetitor")
  events       Event[]        @relation("CompetitorToEvent")

  @@map("competitors")
}

model EventResults {
  eventId      String
  competitorId String
  placing      String
  created_at   DateTime     @default(now())
  score        Float
  id           String       @id @default(uuid())
  competitor   Competitor   @relation(fields: [competitorId], references: [id], onDelete: Cascade)
  event        Event        @relation(fields: [eventId], references: [id], onDelete: Cascade)
  estandartes  BannerType[] @relation("BannerTypeToEventResults")

  @@map("events_results")
}

model Bets {
  userId      String
  eventId     String
  bets        String[]
  created_at  DateTime       @default(now())
  points      Int            @default(0)
  id          String         @id @default(uuid())
  event       Event          @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user        User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  estandartes GoldenBanner[]

  @@index([userId, eventId])
  @@map("bets")
}

model Judge {
  id          String  @id @default(uuid())
  description String
  avatar      String
  first_name  String
  last_name   String
  nickname    String
  badges      Badge[] @relation("BadgeToJudge")
  events      Event[] @relation("EventToJudge")

  @@map("judges")
}

model BannerType {
  id           String         @id @default(uuid())
  name         String
  description  String
  goldenBanner GoldenBanner[]
  events       Event[]        @relation("BannerTypeToEvent")
  resultado    EventResults[] @relation("BannerTypeToEventResults")

  @@map("banner_types")
}

model GoldenBanner {
  competitorId String
  eventId      String
  bannerTypeId String
  betId        String
  userId       String
  bannerType   BannerType @relation(fields: [bannerTypeId], references: [id], onDelete: Cascade)
  bet          Bets       @relation(fields: [betId], references: [id], onDelete: Cascade)
  competitor   Competitor @relation(fields: [competitorId], references: [id], onDelete: Cascade)
  event        Event      @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user         User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([competitorId, eventId, bannerTypeId, userId], name: "id")
  @@map("golden_banners")
}

model Feedback {
  id         String   @id @default(uuid())
  userId     String
  content    String
  created_at DateTime @default(now())
  image      String?
  verified   Boolean  @default(false)
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("feedbacks")
}

model Notification {
  id                String             @id @default(uuid())
  title             String
  content           String
  icon              String?
  created_at        DateTime           @default(now())
  link              String?
  userNotifications UserNotification[]

  @@map("notifications")
}

model UserNotification {
  id             String       @id @default(uuid())
  is_visualized  DateTime?
  created_at     DateTime     @default(now())
  userId         String
  notificationId String
  notification   Notification @relation(fields: [notificationId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_notifications")
}

model Badge {
  id          String       @id @default(uuid())
  created_at  DateTime     @default(now())
  name        String
  description String
  image_url   String
  competitors Competitor[] @relation("BadgeToCompetitor")
  judges      Judge[]      @relation("BadgeToJudge")
  users       User[]       @relation("BadgeToUser")

  @@map("badges")
}

model Season {
  id          String       @id @default(uuid())
  name        String
  created_at  DateTime     @default(now())
  userSeasons UserSeason[]

  @@map("seasons")
}

model UserSeason {
  id       String @id @default(uuid())
  userId   String
  seasonId String
  points   Int    @default(0)
  position Int    @default(0)
  user     User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  season   Season @relation(fields: [seasonId], references: [id], onDelete: Cascade)

  @@map("user_seasons")
}

enum Role {
  USER
  ADMIN
}
